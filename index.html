<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Predictor Pro</title>
    <style>
        :root { --primary: #0f172a; --accent: #0ea5e9; --bg: #f1f5f9; --win: #10b981; --loss: #ef4444; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; }
        header { background: var(--primary); color: white; padding: 1rem; text-align: center; position: relative; }
        .container { max-width: 850px; margin: auto; padding: 15px; }
        
        /* Admin UI */
        #admin-ui { display: none; background: white; padding: 20px; border: 2px solid var(--accent); border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .search-box { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #cbd5e1; border-radius: 6px; box-sizing: border-box;}
        .api-fixture { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; }
        
        /* User UI */
        .date-nav { display: flex; background: white; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; z-index: 10; }
        .date-nav button { flex: 1; padding: 15px; border: none; background: none; font-weight: 700; cursor: pointer; color: #64748b; }
        .date-nav button.active { border-bottom: 3px solid var(--accent); color: var(--primary); }
        .match-card { background: white; padding: 16px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-left: 5px solid var(--primary); }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; color: white; margin-left: 5px; }
        .b-win { background: var(--primary); } .b-dc { background: #64748b; }
        button.action { padding: 6px 12px; border-radius: 6px; cursor: pointer; border: 1px solid #cbd5e1; }
    </style>
</head>
<body>

<header>
    <h2 style="margin:0">PREDICT PRO</h2>
    <button onclick="window.unlockAdmin()" style="position:absolute; right:10px; top:15px;">Admin</button>
</header>

<div class="container">
    <div id="admin-ui">
        <h3>Admin Panel</h3>
        <input type="date" id="fetch-date">
        <button onclick="window.fetchFromAPI()" style="background:var(--primary); color:white; padding:10px; border:none; width:100%; border-radius:6px;">Fetch Today's Games</button>
        
        <input type="text" id="api-search" class="search-box" placeholder="Search team (e.g. Arsenal)..." onkeyup="window.filterAPILis()">
        
        <div id="api-list" style="max-height:300px; overflow-y:auto; border:1px solid #eee; margin-top:10px;"></div>
    </div>

    <nav class="date-nav">
        <button id="tab-yesterday" onclick="window.switchDate('yesterday')">Yesterday</button>
        <button id="tab-today" onclick="window.switchDate('today')" class="active">Today</button>
        <button id="tab-tomorrow" onclick="window.switchDate('tomorrow')">Tomorrow</button>
    </nav>

    <div id="live-predictions"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

    const firebaseConfig = {
        databaseURL: "https://foot-6cea2-default-rtdb.firebaseio.com" // ROOT URL ONLY
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let passkey = "";
    let activeView = 'today';
    const API_TOKEN = "84894bcd59084ad998673b09f0bc221c";

    window.unlockAdmin = () => {
        const entry = prompt("Enter Passkey:");
        if(entry) { passkey = entry; document.getElementById('admin-ui').style.display = 'block'; render(); }
    };

    window.switchDate = (val) => {
        activeView = val;
        document.querySelectorAll('.date-nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(`tab-${val}`).classList.add('active');
        render();
    };

    window.fetchFromAPI = async () => {
        const date = document.getElementById('fetch-date').value;
        const listDiv = document.getElementById('api-list');
        if(!date) return alert("Select Date");
        
        // Using direct API call (This works on GitHub/Live servers without proxy)
        try {
            const res = await fetch(`https://api.football-data.org/v4/matches?dateFrom=${date}&dateTo=${date}`, {
                headers: { "X-Auth-Token": API_TOKEN }
            });
            const data = await res.json();
            window.allFixtures = data.matches; // Store globally for searching
            window.filterAPILis();
        } catch (e) { alert("API Error. Ensure you are hosted on a live server or use the CORS proxy for local testing."); }
    };

    window.filterAPILis = () => {
        const query = document.getElementById('api-search').value.toLowerCase();
        const listDiv = document.getElementById('api-list');
        listDiv.innerHTML = "";
        
        window.allFixtures.filter(m => 
            m.homeTeam.name.toLowerCase().includes(query) || 
            m.awayTeam.name.toLowerCase().includes(query)
        ).forEach(m => {
            const row = document.createElement('div');
            row.className = "api-fixture";
            row.innerHTML = `
                <span>${m.homeTeam.name} vs ${m.awayTeam.name}</span>
                <div>
                    <select id="p1-${m.id}"><option>1</option><option>X</option><option>2</option></select>
                    <select id="pd-${m.id}"><option>1X</option><option>12</option><option>X2</option></select>
                    <button onclick="window.saveMatch('${m.id}', '${m.competition.name.replace(/'/g,"")}', '${m.homeTeam.name.replace(/'/g,"")}', '${m.awayTeam.name.replace(/'/g,"")}', '${m.utcDate}')">Add</button>
                </div>`;
            listDiv.appendChild(row);
        });
    };

    window.saveMatch = (id, league, home, away, utc) => {
        const d = new Date(utc);
        push(ref(db, 'matches'), {
            league, homeTeam: home, awayTeam: away,
            pred1X2: document.getElementById(`p1-${id}`).value,
            predDC: document.getElementById(`pd-${id}`).value,
            date: d.toISOString().split('T')[0],
            time: d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false}),
            status: 'pending', adminKey: passkey
        }).then(() => alert("Posted!"));
    };

    window.updateStatus = (id, s) => update(ref(db, `matches/${id}`), { status: s, adminKey: passkey });

    function render() {
        const d = new Date();
        if(activeView === 'yesterday') d.setDate(d.getDate() - 1);
        if(activeView === 'tomorrow') d.setDate(d.getDate() + 1);
        const target = d.toISOString().split('T')[0];

        onValue(ref(db, 'matches'), (snap) => {
            const data = snap.val();
            const cont = document.getElementById('live-predictions');
            cont.innerHTML = "";
            if(!data) return;

            Object.entries(data).filter(([id, m]) => m.date === target).forEach(([id, m]) => {
                const icon = m.status === 'win' ? '✅' : (m.status === 'loss' ? '❌' : '⏳');
                cont.innerHTML += `
                    <div class="match-card">
                        <div><small>${m.time} | ${m.league}</small><br><b>${m.homeTeam} vs ${m.awayTeam}</b></div>
                        <div>
                            <span class="badge b-win">${m.pred1X2}</span>
                            <span class="badge b-dc">${m.predDC}</span>
                            <span style="margin-left:10px">${icon}</span>
                            ${passkey ? `<br><button class="action" onclick="window.updateStatus('${id}','win')">Win</button><button class="action" onclick="window.updateStatus('${id}','loss')">Loss</button>` : ''}
                        </div>
                    </div>`;
            });
        });
    }
    render();
</script>
</body>
</html>
